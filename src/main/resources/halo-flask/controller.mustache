import connexion
import six
from flask import request, jsonify
from halo_app.app.boundary import IBoundaryService
from halo_app.const import HTTPChoice
from halo_app.sys_util import SysUtil
from halo_bian.bian.util import BianUtil
from halo_bian.bian.app.context import BianContext

	
{{#imports}}{{import}}  # noqa: E501
{{/imports}}
from {{packageName}} import util
{{#operations}}
{{#operation}}

def {{operationId}}({{#allParams}}{{paramName}}{{^required}}=None{{/required}}{{#hasMore}}, {{/hasMore}}{{/allParams}}):  # noqa: E501
    """{{#summary}}{{.}}{{/summary}}{{^summary}}{{operationId}}{{/summary}}

    {{#notes}}{{.}}{{/notes}} # noqa: E501

    {{#allParams}}
    :param {{paramName}}: {{description}}
        {{^isContainer}}
            {{#isPrimitiveType}}
    :type {{paramName}}: {{>param_type}}
            {{/isPrimitiveType}}
            {{#isUuid}}
    :type {{paramName}}: {{>param_type}}
            {{/isUuid}}
            {{^isPrimitiveType}}
                {{#isFile}}
    :type {{paramName}}: werkzeug.datastructures.FileStorage
                {{/isFile}}
                {{^isFile}}
                    {{^isUuid}}
    :type {{paramName}}: dict | bytes
                    {{/isUuid}}
                {{/isFile}}
            {{/isPrimitiveType}}
        {{/isContainer}}
        {{#isListContainer}}
            {{#items}}
                {{#isPrimitiveType}}
    :type {{paramName}}: List[{{>param_type}}]
                {{/isPrimitiveType}}
                {{^isPrimitiveType}}
    :type {{paramName}}: list | bytes
                {{/isPrimitiveType}}
            {{/items}}
        {{/isListContainer}}
        {{#isMapContainer}}
            {{#items}}
                {{#isPrimitiveType}}
    :type {{paramName}}: Dict[str, {{>param_type}}]
                {{/isPrimitiveType}}
                {{^isPrimitiveType}}
    :type {{paramName}}: dict | bytes
                {{/isPrimitiveType}}
            {{/items}}
        {{/isMapContainer}}
    {{/allParams}}

    :rtype: {{#returnType}}{{.}}{{/returnType}}{{^returnType}}None{{/returnType}}
    """

    if 'collection_filter' in vars() or 'queryparams' in vars():
        from {{packageName}}.app.utilx import get_flask_filters
        try:
            if 'collection_filter' in vars():
                item = vars()['collection_filter']
                collection_filter = get_flask_filters(vars()['collection_filter'])
            else:
                item = vars()['queryparams']
                queryparams = get_flask_filters(vars()['queryparams'])
        except Exception as e:
            error_code = 400
            payload = {"error": {"error_code": error_code, "error_message": e.__str__(),
                "error_detail": 'filter format error',
                "data": item,
                "trace_id": request.headers.get(BianContext.CORRELATION)}
            }
            return jsonify(payload), error_code


    bian_context = BianUtil.get_bian_context(request)

    method_id = "{{operationId}}"

    boundary:IBoundaryService = SysUtil.get_boundary()

    bian_request = BianUtil.create_bian_request(bian_context,method_id,vars())

    bian_response = boundary.execute(bian_request)

    bian_response = BianUtil.process_ok(bian_response)

    headers = BianUtil.get_headers(bian_response)

    return jsonify(bian_response.payload), bian_response.code, headers

{{/operation}}
{{/operations}}

